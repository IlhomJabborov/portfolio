{% extends "base.html" %}
{% load static %}
{% block title %}
    <title>Video Kontentlarim</title>
{% endblock %}

{% block content %}
<section class="video-area">
    <div class="container">
        <h1 class="section-heading" data-aos="fade-up">
            <img src="{% static '/images/star-2.png' %}" alt="Star"> Video Kontentlarim <img src="{% static '/images/star-2.png' %}" alt="Star">
        </h1>
        
        <div class="row">
            {% for video in videos %}
            <div class="col-md-4" data-aos="zoom-in">
                <div class="video-item shadow-box" onclick="openVideoModal('{{ video.link }}')">
                    <img src="{{ video.thumbnail.url }}" alt="{{ video.title }}" class="video-thumbnail">
                    <h3>{{ video.title }}</h3>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Video Modal -->
<div id="videoModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeVideoModal()">&times;</span>
        <iframe id="modalVideo" width="800" height="450" frameborder="0" allowfullscreen></iframe>
    </div>
</div>

<script>
    function openVideoModal(videoUrl) {
        var modal = document.getElementById("videoModal");
        var iframe = document.getElementById("modalVideo");
    
        var videoId = extractYouTubeVideoId(videoUrl);
        if (videoId) {
            iframe.src = "https://www.youtube.com/embed/" + videoId + "?autoplay=1"; // Avtomatik ijro
            modal.style.display = "flex";
        } else {
            alert("Video link noto‘g‘ri!");
        }
    }
    
    function extractYouTubeVideoId(url) {
        var videoId = null;
    
        // "youtube.com/watch?v=" linkidan video ID ni olish
        var match = url.match(/[?&]v=([^&]+)/);
        if (match) {
            videoId = match[1];
        }
    
        // "youtu.be/VIDEO_ID" formatidan video ID olish
        if (!videoId) {
            match = url.match(/youtu\.be\/([^?]+)/);
            if (match) {
                videoId = match[1];
            }
        }
    
        // "youtube.com/live/VIDEO_ID" formatidan video ID olish (Live stream uchun)
        if (!videoId) {
            match = url.match(/youtube\.com\/live\/([^?]+)/);
            if (match) {
                videoId = match[1];
            }
        }
    
        return videoId;
    }
    
    function closeVideoModal() {
        var modal = document.getElementById("videoModal");
        var iframe = document.getElementById("modalVideo");
        iframe.src = ""; // Ijro to‘xtaydi
        modal.style.display = "none";
    }
    </script>
    
<style>
.video-area .row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
}
.video-item {
    cursor: pointer;
    text-align: center;
    padding: 10px;
    width: 100%;
    max-width: 320px;
}
.video-thumbnail {
    width: 100%;
    border-radius: 8px;
}
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    justify-content: center;
    align-items: center;
}
.modal-content {
    position: relative;
    background: #fff;
    padding: 20px;
    border-radius: 8px;
    width: 80%;
    max-width: 800px;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.modal-content iframe {
    width: 100%;
    border-radius: 8px;
}
.close {
    position: absolute;
    top: 3px;  /* Tugmani pastroqqa tushirdik */
    right: 5px;  /* Chapga nisbatan biroz surdik */
    font-size: 30px;  /* O‘lchamini kichikroq qildik */
    cursor: pointer;
    color: white;  /* Matn rangi oq */
    background: red;  /* Tugma foni qizil */
    padding: 5px 10px;  /* Tugma kattaligi */
    border-radius: 5px;  /* Yumuq burchaklar */
}

</style>
{% endblock %}
